<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <title>Apsis Labs | Preparing for Docker</title>
    <!-- !START meta -->
    <meta name="description" content="It is a dark winter day at your desk in Maine and your boss gets back from sunny California and says &ldquo;Docker is the best, we need to start using this f...">
    <link rel="canonical" href="/blog/2017/01/13/preparing-for-docker">
    <link rel="alternate" type="application/rss+xml" title="Development Chop Shop" href="/feed.xml">
    <meta content="Apsis Labs" property="og:site_name">
    <meta content="Preparing for Docker" property="og:title">
    <meta content="article" property="og:type">
    <meta content="It is a dark winter day at your desk in Maine and your boss gets back from sunny California and says &ldquo;Docker is the best, we need to start using this f..." property="og:description">
    <meta content="/blog/2017/01/13/preparing-for-docker" property="og:url">
    <meta content="2017-01-13T00:00:00+00:00" property="article:published_time">
    <meta content="/assets/posts/shipping-containers.jpg" property="og:image">
    <!-- !END meta -->
    <!-- !START favicons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/assets/favicons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png">
    <link rel="icon" type="image/png" href="/assets/favicons/favicon.ico">
    <!-- !END favicons -->
    <!-- !START polyfill -->
    <!--[if lt IE 9]>
      <script type="text/javascript" src="/assets/vendor/html5shiv.min.js"></script>
      <script type="text/javascript" src="/assets/vendor/html5shiv-printshiv.min.js"></script>
    <![endif]-->
    <script type="text/javascript" src="/assets/polyfill.js" async="async"></script>
    <!-- !END polyfill -->
    <!-- !START styles -->
    <link type="text/css" rel="stylesheet" href="/assets/app.css">
    <!-- !END styles -->
  </head>
  <body class="">
    <!-- !START navbar -->
    <header id="navbar" class="navbar ">
      <div class="navbar__header">
        <a href="/" class="logo logo--navbar logo--mobile navbar__logo">
          <picture>
            <source media="(min-width: 960px)" srcset="/assets/logos/apsis_blue.png" />
            <source srcset="/assets/logos/apsis_mobile_blue.png" />
            <img src="/assets/logos/apsis_blue.png" alt="Apsis Labs" class="logo__image">
          </picture>
          <h1 class="logo__text">Apsis Labs</h1>
        </a>
        <button id="nav-toggle" class="navbar__nav-toggle">
          <span class="navicon ">
            <span class="navicon__bar"></span>
          </span>
          <span class="sr">Toggle Menu</span>
        </button>
      </div>
      <nav class="navbar__nav">
        <a class="navbar__nav-link" href="/#services">Services</a>
        <a class="navbar__nav-link" href="/#about">About</a>
        <a class="navbar__nav-link" href="/#clients">Clients</a>
        <a class="navbar__nav-link" href="/#contact">Contact</a>
        <a class="navbar__nav-link" href="/jobs/">Jobs</a>
        <a class="navbar__nav-link" href="/blog/">Blog</a>
      </nav>
    </header>
    <!-- !END navbar -->
    <!-- !START content -->
    <div id="content">
      <!-- !START schema.org -->
      <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "headline": "Preparing for Docker",
            "datePublished": "2017-01-13 00:00:00 +0000",
            "dateModified": "2017-01-13 00:00:00 +0000",
            "author": {
              "@type": "Person",
              "name": "Eric Greer"
            },
            "publisher": {
              "@type": "Organization",
              "name": "Apsis Labs",
              "logo": "/assets/logos/apsis_blue.png"
            },
            "mainEntityOfPage": {
              "@type": "WebPage",
              "@id": "/blog/2017/01/13/preparing-for-docker"
            },
        
              "image": ["/assets/posts/shipping-containers.jpg"]
        
          }
      </script>
      <!-- !END schema.org -->
      <div class="post-wrapper post-wrapper--single">
        <div class="container">
          <article class="post">
            <header class="post__header">
              <div class="post__image-wrapper">
                <img src="/assets/posts/shipping-containers.jpg" alt="Preparing for Docker. Photo by olafpictures." class="post__image" data-action="zoom">
              </div>
              <small class="post__photo-credit">Image by olafpictures</small>
              <h2 class="post__title" itemprop="name headline">
                <a href="">
                  Preparing for Docker
        </a>
              </h2>
            </header>
            <div class="post__content">
              <p>It is a dark winter day at your desk in Maine and your boss gets back from sunny California and says &ldquo;Docker is the best, we need to start using this for everything!&rdquo;. You internally groan because you just got all the infrastructure working correctly, but you start frantically searching how to setup and run Docker and jump right into figuring out how to apply it to your current projects because it needs to be done yesterday.</p>
              <p>Before looking into how to setup Docker, let&rsquo;s fill in the basics of what you always wanted to know about Docker but didn&rsquo;t know you needed to ask.</p>
              <h2>What is Docker?</h2>
              <p>Docker is a tool for developing applications in a virtualized operating system, called a container, which can run on any hardware, guaranteeing that the software runs the same in any environment.</p>
              <p>Docker containers allow you to install anything that would normally be installed on a server to run your application into a portable file that can be moved from environment to environment without any need to reinstall the dependencies.</p>
              <p>Docker is similar to Vagrant and VMWare; all three of which allow you to setup virtual infrastructure on top of physical hardware, but each one has its own degree of control. Docker containers operate on the principle that each container runs one process vs running multiple services on one VM.</p>
              <p>What about Docker Compose? Docker Compose is tool set provided by Docker for configuring, networking and deploying multiple containers for more complex application configurations.</p>
              <h2>Why Docker?</h2>
              <p>There are many reasons for choosing Docker:</p>
              <ul>
                <li>Ease of Creation - Image is defined in one file, with simple run commands</li>
                <li>Speed - Much faster than a full VM for startup ( after the initial download )</li>
                <li>Size - Although the images can inflate really quickly they are generally smaller than full VMs</li>
                <li>Consistency - The image used locally can be the same as production</li>
                <li>Reproducibility - Container configuration is a file which can be stored in version control</li>
              </ul>
              <p>Docker is very well designed for local development as it focuses on running one application in its own environment. This helps separate processes from different applications without having to setup multiple VMs.</p>
              <p>For all the various projects you may interact with, most likely there is a Docker image already preconfigured with the basic software for running your particular language ( Rails, Python, etc ) or software ( Nginx, Memcached, MySQL, etc. ) Just take a look on Docker Hub and look for the official tag for any library.</p>
              <h2>Production Concerns</h2>
              <p>As you think about moving your Docker application into production there becomes a whole host of challenges and problems you will need to solve.</p>
              <ul>
                <li>Container Hosting - Hosted vs cloud repositories like Docker Hub or Quay.io</li>
                <li>Deployment Strategies - Tools like Rancher or Kubernetes</li>
                <li>Garbage Collection - Old images fill up disk on the host</li>
                <li>Database Management - Don&rsquo;t run in a container!</li>
                <li>Logging - Shared mounted volume to write log to disk vs external logging service</li>
                <li>Monitoring - Performance, uptime, resource utilization, etc.</li>
              </ul>
              <p>Cloud 66 has a great article detailing these items before using Docker in production: <a href="http://blog.cloud66.com/9-crtitical-decisions-needed-to-run-docker-in-production/">http://blog.cloud66.com/9-crtitical-decisions-needed-to-run-docker-in-production/</a></p>
              <h2>Tips and Tricks</h2>
              <h3>Planning the Architecture</h3>
              <p>Deciding whether Nginx in front of the Rails application or Memcached in front of the DB is the right choice for the system will help determine how to setup a Docker network. Docker Compose allows setup for networking between multiple containers, any external dependencies, volumes, and environmental variables the containers may need.</p>
              <h3>Image Size</h3>
              <p>Docker containers can grow in size very quickly, and minimizing the size helps portability. Every command run in the DockerFile creates its own container as a snapshot which helps reuse across Docker builds but increases the size significantly. To minimize the container, start by finding the minimal image that will support the software and only install the minimal software needed. The next step is to condense all the run commands into the fewest number needed.</p>
              <p>For example when installing dependencies a typical install might look like:</p>
              <div class="highlight">
                <pre><code class="language-" data-lang="">RUN apt-get update -qq &amp;&amp; apt-get install -y build-essential
RUN apt-get update -qq &amp;&amp; apt-get install -y nodejs
RUN apt-get update -qq &amp;&amp; apt-get install -y python2.7
</code></pre>
              </div>
              <p>This creates three containers. A more optimized version that only creates one container is:</p>
              <div class="highlight">
                <pre><code class="language-" data-lang="">RUN apt-get update -qq &amp;&amp; apt-get install -y \
    build-essential \
    nodejs \
    python2.7
</code></pre>
              </div>
              <p>Codeship has a great article detailing some of the optimizations for the Dockerfile: <a href="https://blog.codeship.com/reduce-docker-image-size/">https://blog.codeship.com/reduce-docker-image-size/</a></p>
              <h3>Cleanup</h3>
              <p>Monitoring the host&rsquo;s disk space where Docker containers are deployed is crucial, especially in development environments where several versions of a Docker container may be pushed a day. The easy way to clean up is to setup a cron to run:</p>
              <div class="highlight">
                <pre><code class="language-" data-lang="">sudo docker images -q | xargs sudo docker rmi
</code></pre>
              </div>
              <p>Or you can run a full container to manage garbage collection for you: <a href="https://github.com/spotify/docker-gc">https://github.com/spotify/docker-gc</a></p>
              <h2>Wrap up</h2>
              <p>Docker is a great technology for development environments and simpler applications, but consider carefully whether it is a good fit for your particular application&rsquo;s needs, especially if there is already a technology stack in place.</p>
              <p>Here at Apsis we use the technology that is right for the application and are constantly looking out for changes in best practices and supporting technologies, so I&rsquo;m sure you&rsquo;ll hear more about our exploration with Docker in future posts.</p>
              <p><em>&ldquo;Wait, what do you mean we aren&rsquo;t going to use Docker anymore? I just got everything converted&hellip; Noaaahhh!!!&rdquo;</em></p>
              <h2>Resources</h2>
              <p>For everything you can do with Docker and Docker Compose it is good to check out the docs.</p>
              <p><a href="https://docs.docker.com">https://docs.docker.com</a></p>
              <p>For help finding the perfect image, Docker Hub has your back.</p>
              <p><a href="https://hub.docker.com/">https://hub.docker.com/</a></p>
              <p>For index of everything Docker checkout Awesome Docker:</p>
              <p><a href="https://veggiemonk.github.io/awesome-docker/">https://veggiemonk.github.io/awesome-docker/</a></p>
            </div>
            <aside class="author-block">
              <img src="/assets/people/eric.jpg" alt="Eric Greer" class="author-block__image">
              <header class="author-block__header">
                <h5 class="author-block__title">Eric Greer</h5>
              </header>
              <div class="author-block__content">
                <p>Eric is generalist software developer who can crawl through SQL optimizations, or match a front-end to a design document. In his off time from Apsis he is working on running his own company.</p>
              </div>
            </aside>
          </article>
        </div>
      </div>
    </div>
    <!-- !END content -->
    <!-- !START footer -->
    <footer id="footer" class="site-footer">
      <div class="container">
        <small>
          &copy; 2021 apsis labs
            |
            shuttle image credit NASA
        </small>
      </div>
    </footer>
    <!-- !END footer -->
    <!-- !START javascript includes -->
    <script type="text/javascript" src="/assets/vendor.js"></script>
    <script type="text/javascript" src="/assets/scripts.js"></script>
    <!-- !END javascript includes -->
    <!-- !START Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      
                  ga('create', 'UA-47858702-1', 'auto');
                  ga('send', 'pageview');
    </script>
    <!-- !END Google Analytics -->
    <!-- !START google fonts -->
    <script type="text/javascript">
      WebFontConfig = {
              google: { families: [ 'Open+Sans:400,300,300italic,400italic,600,700,600italic,700italic:latin', 'Source+Code+Pro:400,500,600,700:latin', 'Lora:400,400italic,700,700italic:latin' ] }
          };
      
          (function() {
              var wf = document.createElement('script');
              wf.src = 'https://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
              wf.type = 'text/javascript';
              wf.async = 'true';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(wf, s);
          })();
    </script>
    <!-- !END google fonts -->
  </body>
</html>