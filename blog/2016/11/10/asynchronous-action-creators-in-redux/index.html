<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Blog: <!-- -->Asynchronous Action Creators in Redux<!-- --> | Apsis Labs</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/media/a34f9d1faa5f3315-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/37e85b36581a02ab-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/a9387c470a117487-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/3478b6abef19b3b3-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/035951aefad7b653-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/css/902fc33b34da2cf3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/902fc33b34da2cf3.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b00c133a4a34a799.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b00c133a4a34a799.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-38cee4c0e358b1a3.js" defer=""></script><script src="/_next/static/chunks/framework-64ad27b21261a9ce.js" defer=""></script><script src="/_next/static/chunks/main-58eb4e77e43e295f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-117cd370142abc6d.js" defer=""></script><script src="/_next/static/chunks/25-c9e36e11cdefe32e.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Byear%5D/%5Bmonth%5D/%5Bday%5D/%5Bslug%5D-90b6ae62b9b706e4.js" defer=""></script><script src="/_next/static/W4pufNDEt06x3-24viEGe/_buildManifest.js" defer=""></script><script src="/_next/static/W4pufNDEt06x3-24viEGe/_ssgManifest.js" defer=""></script><style id="__jsx-32619431">:root{--font-inter:'__Inter_36bd41', '__Inter_Fallback_36bd41';--font-mono:'__IBM_Plex_Mono_332d21', '__IBM_Plex_Mono_Fallback_332d21'}</style></head><body><div id="__next"><section class="Section_section__rDOJq Section_section--bordered__v_Az0"><div class="Section_section__mask__iGDmr"></div><div class="Section_section__container__9Fwqr"><div class="Section_section__content__Klb0i"><nav class="Navbar_navbar__pYr0W"><a class="Navbar_navbar__logo__NNGhf" href="/"><h1 class="LogoType_logotype__iHLMP"><svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" class="LogoType_logotype__planet__674Ub" width="24" height="24"><path fill-rule="evenodd" clip-rule="evenodd" d="M32 64C49.6731 64 64 49.6731 64 32C64 14.3269 49.6731 0 32 0C14.3269 0 0 14.3269 0 32C0 49.6731 14.3269 64 32 64ZM32 61C48.0163 61 61 48.0163 61 32C61 15.9837 48.0163 3 32 3C15.9837 3 3 15.9837 3 32C3 48.0163 15.9837 61 32 61ZM58 32C58 46.3594 46.3594 58 32 58C17.6406 58 6 46.3594 6 32C6 17.6406 17.6406 6 32 6C46.3594 6 58 17.6406 58 32ZM44 26C47.3137 26 50 23.3137 50 20C50 16.6863 47.3137 14 44 14C40.6863 14 38 16.6863 38 20C38 23.3137 40.6863 26 44 26Z" fill="currentColor"></path></svg>Apsis Labs</h1></a><nav class="Navbar_navbar__nav__YFZzV"><a class="Navbar_navbar__nav_item__OpfdQ" href="/">Home</a><a class="Navbar_navbar__nav_item__OpfdQ" href="/blog/">Blog</a></nav></nav></div></div></section><section class="Section_section__rDOJq Section_section--spaced__Ihmp2 Section_section--narrow__GIboH"><div class="Section_section__mask__iGDmr"></div><div class="Section_section__container__9Fwqr"><div class="Section_section__content__Klb0i"><div class="Post_post-wrapper__s850H"><article class="Post_post__m_Xor" itemType="http://schema.org/BlogPosting"><header class="Post_post__header__pEZ4C"><div><h1 class="Post_post__title__eUeKR"><a href="/blog/2016/11/10/asynchronous-action-creators-in-redux/">Asynchronous Action Creators in Redux</a></h1><footer class="Post_post__meta__j55Gy">Posted on<!-- --> <time dateTime="2016-11-10" itemProp="datePublished">2016-11-10</time> <!-- -->by<!-- --> <span itemProp="author" itemscope="" itemType="http://schema.org/Person"><span itemProp="name">niall</span></span></footer></div><div class="Post_post__image-wrapper__mjNlP"><img src="/img/posts/clocke.jpg" alt="Asynchronous Action Creators in Redux" class="Post_post__image__Dbjks" data-action="zoom"/></div></header><div class="Post_post__content__SHRW1"><p>Redux applications often use the <a href="https://github.com/gaearon/redux-thunk">redux-thunk</a> middleware to dispatch actions for interacting with an HTTP API.  A pattern for asynchronous action creators is demonstrated in the <a href="http://redux.js.org/docs/advanced/AsyncActions.html">documentation</a> as follows (adding the error catching logic it recommends for a real-world application):</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">REQUEST_POSTS</span> = <span class="hljs-string">&#x27;REQUEST_POSTS&#x27;</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">requestPosts</span>(<span class="hljs-params">subreddit</span>) {
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">type</span>: <span class="hljs-variable constant_">REQUEST_POSTS</span>,
        subreddit
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">RECEIVE_POSTS</span> = <span class="hljs-string">&#x27;RECEIVE_POSTS&#x27;</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">receivePosts</span>(<span class="hljs-params">subreddit, json</span>) {
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">type</span>: <span class="hljs-variable constant_">RECEIVE_POSTS</span>,
        subreddit,
        <span class="hljs-attr">posts</span>: json.<span class="hljs-property">data</span>.<span class="hljs-property">children</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> child.<span class="hljs-property">data</span>),
        <span class="hljs-attr">receivedAt</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">RECEIVE_POSTS_ERROR</span> = <span class="hljs-string">&#x27;RECEIVE_POSTS_ERROR&#x27;</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">receivePostsError</span>(<span class="hljs-params">subreddit, error</span>) {
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">type</span>: <span class="hljs-variable constant_">RECEIVE_POSTS_ERROR</span>,
        subreddit,
        error
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchPosts</span>(<span class="hljs-params">subreddit</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">dispatch</span>) {
        <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">requestPosts</span>(subreddit))
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`http://www.reddit.com/r/<span class="hljs-subst">${subreddit}</span>.json`</span>)
            .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
            .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">receivePosts</span>(subreddit, json)))
            .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">receivePostsError</span>(subreddit, error)))
    }
}
</code></pre><p>This is a simple pattern to follow, but it&#39;s a lot of code to write for the little bit of logic contained here.  Even worse, that logic is separated into two non-adjacent blocks which appear out of order of their execution.<sup><a id="footnote-ref-1" href="#footnote-1" data-footnote-ref aria-describedby="footnote-label">1</a></sup></p>
<pre><code class="hljs language-javascript"><span class="hljs-attr">posts</span>: json.<span class="hljs-property">data</span>.<span class="hljs-property">children</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> child.<span class="hljs-property">data</span>),
<span class="hljs-attr">receivedAt</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()

...

<span class="hljs-title function_">fetch</span>(<span class="hljs-string">`http://www.reddit.com/r/<span class="hljs-subst">${subreddit}</span>.json`</span>)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
</code></pre><p>I generally favour simple repetitive code over complex succinct code.  But if your application were to implement this for every API call it made, the typographical burden could prove too great to bear!</p>
<p>Let&#39;s see if we can improve the signal-to-noise (i.e. logic-to-boilerplate) ratio of this action definition without introducing any new dependencies or abstractions.<sup><a id="footnote-ref-2" href="#footnote-2" data-footnote-ref aria-describedby="footnote-label">2</a></sup></p>
<p>Here is the common structure I see in the pattern:</p>
<ol>
<li><p>Every asynchronous action is going to dispatch three types of synchronous actions corresponding to the <code>pending</code>, <code>fulfilled</code>, and <code>rejected</code> state of a promise.  These are the actions that will actually be handled by a reducer.</p>
</li>
<li><p>The asynchronous action creator will have to accept some number of arguments in order to create the promise---in this example, it was just the name of the subreddit---and these arguments should also passed along to the reducer as part of the action object.</p>
</li>
<li><p>The promise is returned to the code calling dispatch, in case it needs to chain some logic of its own.</p>
</li>
</ol>
<p>Those observations lead us to a helper function---I suppose you could call it an asynchronous action creator <em>creator</em>---that looks like this:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">promiseAction</span>(<span class="hljs-params">type, createPromise</span>) {
    <span class="hljs-keyword">const</span> actionTypes = {
        <span class="hljs-attr">START</span>: type + <span class="hljs-string">&#x27;_START&#x27;</span>,
        <span class="hljs-attr">SUCCESS</span>: type + <span class="hljs-string">&#x27;_SUCCESS&#x27;</span>,
        <span class="hljs-attr">ERROR</span>: type + <span class="hljs-string">&#x27;_ERROR&#x27;</span>
    }

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">actionCreator</span> = args =&gt; <span class="hljs-function">(<span class="hljs-params">dispatch, getState</span>) =&gt;</span> {
        <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: actionTypes.<span class="hljs-property">START</span>, ...args })
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">createPromise</span>({ <span class="hljs-attr">state</span>: <span class="hljs-title function_">getState</span>(), ...args }).<span class="hljs-title function_">then</span>(
            <span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: actionTypes.<span class="hljs-property">SUCCESS</span>, result, ...args }),
            <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: actionTypes.<span class="hljs-property">ERROR</span>, error, ...args })
        )
    }

    <span class="hljs-keyword">return</span> [actionTypes, actionCreator]
}
</code></pre><p>Now the action definition from the example can be written with almost no boilerplate:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> [<span class="hljs-variable constant_">FETCH_POSTS</span>, fetchPosts] = <span class="hljs-title function_">promiseAction</span>(<span class="hljs-string">&#x27;FETCH_POSTS&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">{ subreddit }</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`http://www.reddit.com/r/<span class="hljs-subst">${subreddit}</span>.json`</span>)
        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> ({
            <span class="hljs-attr">posts</span>: json.<span class="hljs-property">data</span>.<span class="hljs-property">children</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> child.<span class="hljs-property">data</span>),
            <span class="hljs-attr">receivedAt</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
        }))
})
</code></pre><p>A few notes on the implementation:</p>
<ol>
<li><p>We pass the state into the promise creator.  This makes it possible to implement logic like executing an HTTP request only if the resource hasn&#39;t already been loaded (see the subsequent <code>fetchPostsIfNeeded</code> example from the redux docs) without creating an additional thunk.</p>
</li>
<li><p>The asynchronous action creator is called with object-style arguments rather than an argument list, so they can be passed along as named properties of the synchronous action objects.  Calling code looks like <code>dispatch(createPost({ author, content }))</code>  instead of <code>dispatch(createPost(author, content))</code></p>
</li>
<li><p>We export the three action types as a single object with <code>START</code>, <code>SUCCESS</code>, and <code>ERROR</code> properties instead of exporting three separate strings.  This is really just to have shorter import statements in the reducer.</p>
</li>
</ol>
<p>I like this kind of helper because it makes our code less repetitive while keeping the simplicity of the original.  No new dependencies are added, no new abstractions need to be learned; we just extract a pattern which was already present.</p>
<section class="footnotes" data-footnotes>
<h2 id="footnote-label" class="sr-only">Footnotes</h2>
<ol>
<li id="footnote-1">
<p>Of course, you can&#39;t always write code in order of execution, but when you have a few statements like: parse this JSON, then extract these properties, then set a timestamp; <em>which are always executed together and in that order,</em> it seems silly not to. <a href="#footnote-ref-1" data-footnote-backref aria-label="Back to reference 1">↩</a></p>
</li>
<li id="footnote-2">
<p>If you are willing to increase complexity, there are certainly dependencies that you can introduce!  For example, <a href="https://github.com/acdlite/redux-promise">redux-promise</a> and <a href="https://github.com/pburtchaell/redux-promise-middleware">redux-promise-middleware</a> each implement middleware that allow you to dispatch promises directly.  They also use <a href="https://github.com/acdlite/flux-standard-action">flux standard actions</a>, so that&#39;s another small standard you&#39;ll need to learn.  You may be disappointed if their choice of abstraction does not line up with what you need.  redux-promise does not dispatch a starting action so you&#39;ll probably end up using it in combination with redux-thunk.  redux-promise-middleware has gone through four major versions, changing its interface a bit each time.  Neither exposes application state. <a href="#footnote-ref-2" data-footnote-backref aria-label="Back to reference 2">↩</a></p>
</li>
</ol>
</section>
</div><footer class="Post_post__meta__j55Gy">Posted on<!-- --> <time dateTime="2016-11-10" itemProp="datePublished">2016-11-10</time> <!-- -->by<!-- --> <span itemProp="author" itemscope="" itemType="http://schema.org/Person"><span itemProp="name">niall</span></span></footer></article></div></div></div></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"asynchronous-action-creators-in-redux","href":{"pathname":"/blog/[year]/[month]/[day]/[slug]","query":{"year":"2016","month":"11","day":"10","slug":"asynchronous-action-creators-in-redux"}},"contentHtml":"\u003cp\u003eRedux applications often use the \u003ca href=\"https://github.com/gaearon/redux-thunk\"\u003eredux-thunk\u003c/a\u003e middleware to dispatch actions for interacting with an HTTP API.  A pattern for asynchronous action creators is demonstrated in the \u003ca href=\"http://redux.js.org/docs/advanced/AsyncActions.html\"\u003edocumentation\u003c/a\u003e as follows (adding the error catching logic it recommends for a real-world application):\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eREQUEST_POSTS\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;REQUEST_POSTS\u0026#x27;\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003erequestPosts\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esubreddit\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n        \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-variable constant_\"\u003eREQUEST_POSTS\u003c/span\u003e,\n        subreddit\n    }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eRECEIVE_POSTS\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;RECEIVE_POSTS\u0026#x27;\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ereceivePosts\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esubreddit, json\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n        \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-variable constant_\"\u003eRECEIVE_POSTS\u003c/span\u003e,\n        subreddit,\n        \u003cspan class=\"hljs-attr\"\u003eposts\u003c/span\u003e: json.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003echildren\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003emap\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003echild\u003c/span\u003e =\u0026gt;\u003c/span\u003e child.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e),\n        \u003cspan class=\"hljs-attr\"\u003ereceivedAt\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eDate\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003enow\u003c/span\u003e()\n    }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eRECEIVE_POSTS_ERROR\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;RECEIVE_POSTS_ERROR\u0026#x27;\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ereceivePostsError\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esubreddit, error\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n        \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-variable constant_\"\u003eRECEIVE_POSTS_ERROR\u003c/span\u003e,\n        subreddit,\n        error\n    }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetchPosts\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esubreddit\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003edispatch\u003c/span\u003e) {\n        \u003cspan class=\"hljs-title function_\"\u003edispatch\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003erequestPosts\u003c/span\u003e(subreddit))\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`http://www.reddit.com/r/\u003cspan class=\"hljs-subst\"\u003e${subreddit}\u003c/span\u003e.json`\u003c/span\u003e)\n            .\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eresponse\u003c/span\u003e =\u0026gt;\u003c/span\u003e response.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e())\n            .\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ejson\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edispatch\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003ereceivePosts\u003c/span\u003e(subreddit, json)))\n            .\u003cspan class=\"hljs-title function_\"\u003ecatch\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eerror\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edispatch\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003ereceivePostsError\u003c/span\u003e(subreddit, error)))\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis is a simple pattern to follow, but it\u0026#39;s a lot of code to write for the little bit of logic contained here.  Even worse, that logic is separated into two non-adjacent blocks which appear out of order of their execution.\u003csup\u003e\u003ca id=\"footnote-ref-1\" href=\"#footnote-1\" data-footnote-ref aria-describedby=\"footnote-label\"\u003e1\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-attr\"\u003eposts\u003c/span\u003e: json.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003echildren\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003emap\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003echild\u003c/span\u003e =\u0026gt;\u003c/span\u003e child.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e),\n\u003cspan class=\"hljs-attr\"\u003ereceivedAt\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eDate\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003enow\u003c/span\u003e()\n\n...\n\n\u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`http://www.reddit.com/r/\u003cspan class=\"hljs-subst\"\u003e${subreddit}\u003c/span\u003e.json`\u003c/span\u003e)\n    .\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eresponse\u003c/span\u003e =\u0026gt;\u003c/span\u003e response.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e())\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eI generally favour simple repetitive code over complex succinct code.  But if your application were to implement this for every API call it made, the typographical burden could prove too great to bear!\u003c/p\u003e\n\u003cp\u003eLet\u0026#39;s see if we can improve the signal-to-noise (i.e. logic-to-boilerplate) ratio of this action definition without introducing any new dependencies or abstractions.\u003csup\u003e\u003ca id=\"footnote-ref-2\" href=\"#footnote-2\" data-footnote-ref aria-describedby=\"footnote-label\"\u003e2\u003c/a\u003e\u003c/sup\u003e\u003c/p\u003e\n\u003cp\u003eHere is the common structure I see in the pattern:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cp\u003eEvery asynchronous action is going to dispatch three types of synchronous actions corresponding to the \u003ccode\u003epending\u003c/code\u003e, \u003ccode\u003efulfilled\u003c/code\u003e, and \u003ccode\u003erejected\u003c/code\u003e state of a promise.  These are the actions that will actually be handled by a reducer.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eThe asynchronous action creator will have to accept some number of arguments in order to create the promise---in this example, it was just the name of the subreddit---and these arguments should also passed along to the reducer as part of the action object.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eThe promise is returned to the code calling dispatch, in case it needs to chain some logic of its own.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThose observations lead us to a helper function---I suppose you could call it an asynchronous action creator \u003cem\u003ecreator\u003c/em\u003e---that looks like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003epromiseAction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003etype, createPromise\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e actionTypes = {\n        \u003cspan class=\"hljs-attr\"\u003eSTART\u003c/span\u003e: type + \u003cspan class=\"hljs-string\"\u003e\u0026#x27;_START\u0026#x27;\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eSUCCESS\u003c/span\u003e: type + \u003cspan class=\"hljs-string\"\u003e\u0026#x27;_SUCCESS\u0026#x27;\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eERROR\u003c/span\u003e: type + \u003cspan class=\"hljs-string\"\u003e\u0026#x27;_ERROR\u0026#x27;\u003c/span\u003e\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eactionCreator\u003c/span\u003e = args =\u0026gt; \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003edispatch, getState\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-title function_\"\u003edispatch\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: actionTypes.\u003cspan class=\"hljs-property\"\u003eSTART\u003c/span\u003e, ...args })\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ecreatePromise\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003estate\u003c/span\u003e: \u003cspan class=\"hljs-title function_\"\u003egetState\u003c/span\u003e(), ...args }).\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\n            \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eresult\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edispatch\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: actionTypes.\u003cspan class=\"hljs-property\"\u003eSUCCESS\u003c/span\u003e, result, ...args }),\n            \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eerror\u003c/span\u003e =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edispatch\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: actionTypes.\u003cspan class=\"hljs-property\"\u003eERROR\u003c/span\u003e, error, ...args })\n        )\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e [actionTypes, actionCreator]\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNow the action definition from the example can be written with almost no boilerplate:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [\u003cspan class=\"hljs-variable constant_\"\u003eFETCH_POSTS\u003c/span\u003e, fetchPosts] = \u003cspan class=\"hljs-title function_\"\u003epromiseAction\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;FETCH_POSTS\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003e{ subreddit }\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`http://www.reddit.com/r/\u003cspan class=\"hljs-subst\"\u003e${subreddit}\u003c/span\u003e.json`\u003c/span\u003e)\n        .\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eresponse\u003c/span\u003e =\u0026gt;\u003c/span\u003e response.\u003cspan class=\"hljs-title function_\"\u003ejson\u003c/span\u003e())\n        .\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ejson\u003c/span\u003e =\u0026gt;\u003c/span\u003e ({\n            \u003cspan class=\"hljs-attr\"\u003eposts\u003c/span\u003e: json.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003echildren\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003emap\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003echild\u003c/span\u003e =\u0026gt;\u003c/span\u003e child.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e),\n            \u003cspan class=\"hljs-attr\"\u003ereceivedAt\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eDate\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003enow\u003c/span\u003e()\n        }))\n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eA few notes on the implementation:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cp\u003eWe pass the state into the promise creator.  This makes it possible to implement logic like executing an HTTP request only if the resource hasn\u0026#39;t already been loaded (see the subsequent \u003ccode\u003efetchPostsIfNeeded\u003c/code\u003e example from the redux docs) without creating an additional thunk.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eThe asynchronous action creator is called with object-style arguments rather than an argument list, so they can be passed along as named properties of the synchronous action objects.  Calling code looks like \u003ccode\u003edispatch(createPost({ author, content }))\u003c/code\u003e  instead of \u003ccode\u003edispatch(createPost(author, content))\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eWe export the three action types as a single object with \u003ccode\u003eSTART\u003c/code\u003e, \u003ccode\u003eSUCCESS\u003c/code\u003e, and \u003ccode\u003eERROR\u003c/code\u003e properties instead of exporting three separate strings.  This is really just to have shorter import statements in the reducer.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eI like this kind of helper because it makes our code less repetitive while keeping the simplicity of the original.  No new dependencies are added, no new abstractions need to be learned; we just extract a pattern which was already present.\u003c/p\u003e\n\u003csection class=\"footnotes\" data-footnotes\u003e\n\u003ch2 id=\"footnote-label\" class=\"sr-only\"\u003eFootnotes\u003c/h2\u003e\n\u003col\u003e\n\u003cli id=\"footnote-1\"\u003e\n\u003cp\u003eOf course, you can\u0026#39;t always write code in order of execution, but when you have a few statements like: parse this JSON, then extract these properties, then set a timestamp; \u003cem\u003ewhich are always executed together and in that order,\u003c/em\u003e it seems silly not to. \u003ca href=\"#footnote-ref-1\" data-footnote-backref aria-label=\"Back to reference 1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli id=\"footnote-2\"\u003e\n\u003cp\u003eIf you are willing to increase complexity, there are certainly dependencies that you can introduce!  For example, \u003ca href=\"https://github.com/acdlite/redux-promise\"\u003eredux-promise\u003c/a\u003e and \u003ca href=\"https://github.com/pburtchaell/redux-promise-middleware\"\u003eredux-promise-middleware\u003c/a\u003e each implement middleware that allow you to dispatch promises directly.  They also use \u003ca href=\"https://github.com/acdlite/flux-standard-action\"\u003eflux standard actions\u003c/a\u003e, so that\u0026#39;s another small standard you\u0026#39;ll need to learn.  You may be disappointed if their choice of abstraction does not line up with what you need.  redux-promise does not dispatch a starting action so you\u0026#39;ll probably end up using it in combination with redux-thunk.  redux-promise-middleware has gone through four major versions, changing its interface a bit each time.  Neither exposes application state. \u003ca href=\"#footnote-ref-2\" data-footnote-backref aria-label=\"Back to reference 2\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/section\u003e\n","author":"niall","layout":"post","title":"Asynchronous Action Creators in Redux","image":"/img/posts/clocke.jpg","excerpt":"\u003cp\u003eRedux applications often use the \u003ca href=\"https://github.com/gaearon/redux-thunk\"\u003eredux-thunk\u003c/a\u003e middleware to dispatch actions for interacting with an HTTP API.  A pattern for asynchronous action creators is demonstrated in the [documentation](\u003ca href=\"http://redux.js.org/docs/advanced/AsyncActions\"\u003ehttp://redux.js.org/docs/advanced/AsyncActions\u003c/a\u003e\u003c/p\u003e\n","date":"2016-11-10"}},"__N_SSG":true},"page":"/blog/[year]/[month]/[day]/[slug]","query":{"year":"2016","month":"11","day":"10","slug":"asynchronous-action-creators-in-redux"},"buildId":"W4pufNDEt06x3-24viEGe","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>